<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ticket Modal Main</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="match">
        <ul>
            <li id="match-info">GS MMS VS 한국전력</li>
            <li id="match-stadium">서울하이체육관</li>
            <li id="match-date">2024.10.24(목) 19:00</li>
        </ul>
    </div>
    <div id="seat">
        <table>
            <thead>
                <tr>
                    <th>구역</th>
                    <th>잔여석</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="seat-name">골드</td>
                    <td id="available-seat">90석</td>
                </tr>
            </tbody>
        </table>
    </div>
    <script th:inline="javascript">
        $(document).ready(function(){
            $.ajax({
              url: "/purchase/main/{matchId}",
              type: "get",
              success: function(data) {
                  // data는 MatchTableDTO 리스트입니다.
                  console.log("Matches fetched: ", data);

                  // matchId와 matchDate 등의 값을 서버에서 받아온다고 가정
                  var matchId = data.matchId; // data를 올바르게 정의해야 합니다.
                  var matchDate = new Date(data.matchDate).toLocaleString(); // Date 객체로 변환 후 포맷팅
                  var matchTeam = data.matchTeam; // 데이터에서 직접 가져옴
                  var matchStadium = data.matchStadium; // 데이터에서 직접 가져옴
                  var thisTeam = "GS ITM"; // 예시 팀 이름
                  var matchInfo = "";

                  // 경기 정보 출력 방식 수정
                  if (matchTeam === "서울하이체육관") {
                      matchInfo = thisTeam + " VS " + matchTeam;
                  } else {
                      matchInfo = matchTeam + " VS " + thisTeam;
                  }

                  // 경기 날짜 및 정보 출력
                  $('#match-date').text(matchDate);
                  $('#match-info').text(matchInfo);
                  $('#match-stadium').text(matchStadium);

                // 예매하기 버튼 클릭 시 matchId 포함하여 전송
                  $('#btn-reservation').on("click", function() {
                      $.ajax({
                          url: "/ticket/purchase/main/" + matchId, // matchId를 URL에 포함
                          type: "get",
                          success: function(response) {
                              console.log("Reservation successful:", response);
                              // 성공적인 응답 처리
                          },
                          error: function(xhr, status, error) {
                              console.error('Error fetching match reservation:', error);
                          },
                      });
                  });
              },
              error: function(xhr, status, error) {
                  console.error('Error fetching matches:', error);
              }
          });
      });
    </script>
</body>
</html>