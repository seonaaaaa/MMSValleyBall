<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ticket Modal Main</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="match">
        <ul>
            <li id="match-info">GS MMS VS 한국전력</li>
            <li id="match-stadium">서울하이체육관</li>
            <li id="match-date">2024.10.24(목) 19:00</li>
        </ul>
    </div>
    <div id="seat">
        <table>
            <thead>
                <tr>
                    <th>구역</th>
                    <th>잔여석</th>
                </tr>
            </thead>
            <tbody>
                <tr id="seat-body">
                    <td class="zone-name">골드</td>
                    <td class="available-seat-zone">90석</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="buttons">
        <button id="btn-selection">다음단계</button>
        <button id="btn-cancel">취소</button>
    </div>
    <script th:inline="javascript">
        $(document).ready(function(){
            $.ajax({
              url: "/purchase/main/{matchId}",
              type: "get",
              success: function(data) {
                  // 받아온 데이터 저장
                  var match = data.matchInfo;
                  var seatList = data.availableSeatList;

                  //1. 경기 정보 저장 및 변환
                  var matchId = match.matchId; // match를 올바르게 정의해야 합니다.
                  var matchDate = new Date(match.matchDate).toLocaleString(); // Date 객체로 변환 후 포맷팅
                  var matchTeam = match.matchTeam; // 데이터에서 직접 가져옴
                  var matchStadium = match.matchStadium; // 데이터에서 직접 가져옴
                  var thisTeam = "GS ITM"; // 예시 팀 이름
                  var matchInfo = "";

                  // 경기 정보 출력 방식 수정
                  if (matchTeam === "서울하이체육관") {
                      matchInfo = thisTeam + " VS " + matchTeam;
                  } else {
                      matchInfo = matchTeam + " VS " + thisTeam;
                  }

                  // 경기 날짜 및 정보 출력
                  $('#match-date').text(matchDate);
                  $('#match-info').text(matchInfo);
                  $('#match-stadium').text(matchStadium);

                 //2. 구역별 잔여석 정보 출력
                    seatList.forEach(function(zone) {
                        var zoneRow = `<tr>
                            <td class="zone-name">${zone.zoneName}</td>
                            <td class="available-seat-zone">${zone.availableSeatAmount}석</td>
                        </tr>`;
                        $('#seat-body').append(zoneRow); // 동적으로 구역 추가
                    });

                //다음단계 버튼 클릭 시 matchId 포함하여 전송
                  $('#btn-selection').on("click", function() {
                      $.ajax({
                          url: "/ticket/purchase/selection/" + matchId, // matchId를 URL에 포함
                          type: "get",
                          success: function(response) {
                              console.log("Reservation successful:", response);
                              // 성공적인 응답 처리
                          },
                          error: function(xhr, status, error) {
                              console.error('Error fetching match reservation:', error);
                          },
                      });
                  });
                //취소 버튼 클릭 시 티켓 구매 페이지로 이동
                 $('#btn-cancel').on("click", function(){
                     location.href = '/ticket/purchase';
                 });
              },
              error: function(xhr, status, error) {
                  console.error('Error fetching matches:', error);
              }
          });
      });
    </script>
</body>
</html>