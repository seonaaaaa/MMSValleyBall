<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layoutReal}">
<head>
  <!-- ê°œë³„ í˜ì´ì§€ ì „ìš© CSS íŒŒì¼ -->
  <link rel="stylesheet" th:href="@{/css/game-update.css}">
</head>
<meta charset="UTF-8">
<body>
<div layout:fragment="content" class="content">
  <section>
    <div class="game-update-page">
      <div class="menu-title">ê²½ê¸° ì •ë³´ ìˆ˜ì •</div>

      <!-- ì‹ ê·œ ìˆ˜ì • í¼ -->
      <form id="gameUpdateForm" class="form-table">

        <!-- ê²½ê¸° ID -->
        <div class="form-row">
          <label for="matchId">ğŸ ê²½ê¸° ID</label>
          <input type="text" id="matchId" th:value="${match.matchId}" readonly />
        </div>

        <!-- ê²½ê¸° ë‚ ì§œ ë° ì‹œê°„ -->
        <div class="form-row">
          <label for="matchDate">ğŸ ê²½ê¸° ë‚ ì§œ</label>
          <input type="date" id="matchDate" th:value="${matchDatePart}" required />
          <input type="time" id="matchTime" th:value="${matchTimePart}" required />
        </div>

        <!-- ê²½ê¸°ì¥ ì„ íƒ -->
        <div class="form-row">
          <label for="matchStadium">ğŸ ê²½ê¸°ì¥</label>
          <select id="matchStadium" required>
            <option value="HOME" th:selected="${match.matchStadium == 'HOME'}">HOME</option>
            <option value="AWAY" th:selected="${match.matchStadium == 'AWAY'}">AWAY</option>
          </select>
        </div>

        <!-- ì ìˆ˜ ì…ë ¥ -->
        <div class="form-row">
          <label for="matchSetScore">ğŸ ìš°ë¦¬ íŒ€ ì„¸íŠ¸ ìˆ˜</label>
          <input type="number" id="matchSetScore" name="matchSetScore" th:value="${match.matchSetScore}" required min="0" max="5" />
        </div>
        <div class="form-row">
          <label for="matchOpponentTeamSetScore">ğŸ ìƒëŒ€ íŒ€ ì„¸íŠ¸ ìˆ˜</label>
          <input type="number" id="matchOpponentTeamSetScore" name="matchOpponentTeamSetScore" th:value="${match.matchOpponentTeamSetScore}" required min="0" max="5" />
        </div>

        <!-- ì‹œì¦Œ ì„ íƒ -->
        <div class="form-row">
          <label for="seasonId">ğŸ ì‹œì¦Œ</label>
          <select id="seasonId" required>
            <option th:each="season : ${seasons}" th:value="${season.seasonId}" th:text="${season.seasonName}" th:selected="${season.seasonId == match.seasonId}"></option>
          </select>
        </div>

        <!-- ë¼ìš´ë“œ ì„ íƒ -->
        <div class="form-row">
          <label for="matchRoundId">ğŸ ë¼ìš´ë“œ</label>
          <select id="matchRoundId" name="matchRoundId" required>
            <option th:each="round : ${rounds}"
                    th:value="${round}"
                    th:text="${round + 'ë¼ìš´ë“œ'}"
                    th:selected="${round.toString() == match.matchRoundId.toString()}"></option>
          </select>
        </div>

        <!-- íŒ€ ì´ë¦„ ì„ íƒ -->
        <div class="form-row">
          <label for="teamId">ğŸ íŒ€ ì´ë¦„</label>
          <select id="teamId" name="teamId" required>
            <option th:each="team : ${teams}" th:value="${team.teamId}" th:text="${team.teamName}" th:selected="${team.teamId == match.teamId}"></option>
          </select>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="button-group">
          <button type="submit" class="btn-submit">ì €ì¥</button>
<!--          <a href="/admin/game"><button type="button">ëŒì•„ê°€ê¸°</button></a>-->
          <button type="button" onclick="window.location.href='/admin/game'" class="btn-back">ëŒì•„ê°€ê¸°</button>
        </div>
      </form>
    </div>
  </section>

  <script th:inline="javascript">
    $(document).ready(function() {

      // í¼ ì œì¶œ ì‹œ ë°ì´í„° ì²˜ë¦¬
      $('#gameUpdateForm').on('submit', function(event) {
        event.preventDefault();

        // matchId ê°’ì„ ê°€ì ¸ì˜¤ê¸°
        const matchId = $('#matchId').val();

        // ë‚ ì§œì™€ ì‹œê°„ í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸°
        const matchDate = $('#matchDate').val();
        const matchTime = $('#matchTime').val();

        // í•„ìš”í•œ ë°ì´í„° êµ¬ì„±
        const matchData = {
          matchId: matchId,
          matchDate: `${matchDate}T${matchTime}`, // ë‚ ì§œì™€ ì‹œê°„ì„ ì¡°í•©í•˜ì—¬ ISO í˜•ì‹ìœ¼ë¡œ ì„¤ì •
          matchStadium: $('#matchStadium').val(),
          matchSetScore: $('#matchSetScore').val(),
          matchOpponentTeamSetScore: $('#matchOpponentTeamSetScore').val(),
          seasonId: $('#seasonId').val(),
          matchRoundId: $('#matchRoundId').val(),
          teamId: $('#teamId').val()
        };

        // Ajax ìš”ì²­
        $.ajax({
          url: `/admin/game/update/${matchId}`,
          type: 'POST',
          dataType: 'text',  // ì„œë²„ì—ì„œ String ì‘ë‹µì„ ë°›ê¸° ë•Œë¬¸ì— textë¡œ ì„¤ì •
          data: JSON.stringify(matchData),
          headers: {
            "Content-Type": "application/json"
          },
          success: function(response) {
            alert(response);  // ì„œë²„ì˜ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            alert("ë©”ì¼ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•„ìš” ì‹œ ê³ ê°ì—ê²Œ ë©”ì¼ì„ ë°œì†¡í•´ ì£¼ì„¸ìš”.");
            window.location.href = '/admin/game';  // ì €ì¥ í›„ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
          },
          error: function(xhr, status, error) {
            console.error('ê²½ê¸° ìˆ˜ì • ì˜¤ë¥˜:', error);
            alert('ê²½ê¸° ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        });
      });
    });
  </script>
</div>

</body>
</html>