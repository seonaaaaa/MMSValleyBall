<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layoutReal}">
<head>
    <!-- Í∞úÎ≥Ñ ÌéòÏù¥ÏßÄ Ï†ÑÏö© CSS ÌååÏùº -->
    <link rel="stylesheet" th:href="@{/css/user-list.css}">
    <script th:inline="javascript">
        function filterUsers() {
       const season = document.getElementById("seasonFilter").value;
       const membership = document.getElementById("membershipFilter").value;
       const status = document.getElementById("statusFilter").value;

       const requestData = {
           season: season,
           membership: membership,
           status: status
       };

               fetch('/admin/userList?' + new URLSearchParams(requestData))
                   .then(response => response.text())
                   .then(data => {
                       document.querySelector('body').innerHTML = data;
                   })
                   .catch(error => console.error('Error:', error));
           }
    </script>
</head>
<body>
<div layout:fragment="content" class="content">
    <section>
        <div class="tab-menu">
            <a href="userList" class="active">ÌöåÏõê Ï°∞Ìöå</a>
            <a href="sales">Îß§Ï∂ú Ï°∞Ìöå</a>
            <a href="game">Í≤ΩÍ∏∞ Ï°∞Ìöå</a>
        </div>

        <div class="container">
            <div class="table-header">
                <div class="left-section">
                    <form onsubmit="event.preventDefault(); filterUsers();">
                        <div class="search-bar">
                            <span class="filter-icon">üîç</span>
                            <select name="searchCriteria" id="searchCriteria" class="search-criteria">
                                <option value="name">Ïù¥Î¶Ñ</option>
                                <option value="email">Ïù¥Î©îÏùº</option>
                                <option value="membership">Î©§Î≤ÑÏã≠</option>
                            </select>
                            <input name="keyword" type="text" id="keyword" placeholder="Search...">
                            <button type="submit" id="searchButton">Í≤ÄÏÉâ</button>
                        </div>
                    </form>
                    <!-- Ï¥ù ÌöåÏõê Ïàò ÌëúÏãú -->
                    <span class="allUsers">Ï¥ù ÌöåÏõê Ïàò : <b th:text="${totalUsers}"></b>Î™Ö</span>
                </div>
                <div>
                    <a href="createAdmin"><button class="add-button">+ Ïã†Í∑ú Í¥ÄÎ¶¨Ïûê</button></a>
                    <a th:href="@{/admin/deleteAdmin}"><button class="delete-button">Í¥ÄÎ¶¨Ïûê ÏÇ≠Ï†ú</button></a>
                </div>
            </div>

            <table class="table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Ïù¥Î¶Ñ</th>
                    <th>Ïù¥Î©îÏùº</th>
                    <th>
                        <!-- ÏãúÏ¶å ÌïÑÌÑ∞ -->
                        <label for="seasonFilter">ÏãúÏ¶å</label>
                        <select id="seasonFilter" name="season" onchange="filterUsers()">
                            <option value="" th:selected="${season == ''}">Î™®Îì† ÏãúÏ¶å</option>
                            <option value="24/25" th:selected="${season == '24/25'}">24/25</option>
                            <option value="23/24" th:selected="${season == '23/24'}">23/24</option>
                        </select>
                    </th>
                    <th>
                        <!-- Î©§Î≤ÑÏã≠ ÌïÑÌÑ∞ -->
                        <label for="membershipFilter">Î©§Î≤ÑÏã≠</label>
                        <select id="membershipFilter" name="membership" onchange="filterUsers()">
                            <option value="" th:selected="${membership == ''}">Î™®Îëê Î≥¥Í∏∞</option>
                            <option value="BRONZE" th:selected="${membership == 'BRONZE'}">BRONZE</option>
                            <option value="SILVER" th:selected="${membership == 'SILVER'}">SILVER</option>
                            <option value="GOLD" th:selected="${membership == 'GOLD'}">GOLD</option>
                        </select>
                    </th>
                    <th>Ï∂©Ï†Ñ ÏûîÏï°</th>
                    <th>
                        <!-- ÌöåÏõê ÏÉÅÌÉú ÌïÑÌÑ∞ -->
                        <label for="statusFilter">ÌöåÏõê ÏÉÅÌÉú</label>
                        <select id="statusFilter" name="status" onchange="filterUsers()">
                            <option value="" th:selected="${status == ''}">Î™®Îì† ÏÉÅÌÉú</option>
                            <option value="ACTIVE" th:selected="${status == 'ACTIVE'}">ACTIVE</option>
                            <option value="INACTIVE" th:selected="${status == 'INACTIVE'}">INACTIVE</option>
                        </select>
                    </th>
                    <th>ÏÉùÏÑ±Ïùº</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${userPage}">
                    <td th:text="${user.userId}">1</td>
                    <td>
                        <a th:text="${user.userName}"
                           th:href="@{/admin/userDetail/{userId}(userId = ${user.userId})}">Î∞ïÏÑ†ÏïÑ</a>
                    </td>
                    <td th:text="${user.userEmail}">seon04520@gmail.com</td>
                    <td th:text="${seasonMap[user.userId]}">ÏãúÏ¶å</td>
                    <td th:text="${membershipTypeMap[user.userId]}">Î©§Î≤ÑÏã≠ Ï†ïÎ≥¥</td>
                    <td>
                        <span th:text="${userBalanceMap[user.userId] != null ? #numbers.formatInteger(userBalanceMap[user.userId], 0, 'COMMA') + 'Ïõê' : '0Ïõê'}">0Ïõê</span>
                    </td>
                    <td>
                        <span th:if="${user.userStatus == T(com.team.MMSValleyBall.enums.UserStatus).ACTIVE}"
                              class="status ACTIVE" th:text="${user.userStatus}">ACTIVE
                        </span>
                        <span th:if="${user.userStatus == T(com.team.MMSValleyBall.enums.UserStatus).INACTIVE}"
                              class="status INACTIVE" th:text="${user.userStatus}">INACTIVE
                        </span>
                    </td>
                    <td th:text="${user.userCreateAt}">Í∞ÄÏûÖ ÎÇ†Ïßú</td>
                </tr>
                </tbody>
            </table>

            <div class="pagination">
                <div class="pages">
                    <!-- Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
                    <span th:if="${userPage != null}" th:classappend="${userPage.number <= 0} ? 'disabled'">
                        <a th:href="${userPage.number > 0} ? @{/admin/userList(page=${userPage.number - 1}, size=${userPage.size}, searchCriteria=${searchCriteria}, keyword=${keyword}, membership=${membership}, season=${season}, status=${status})} : '#'">
                            Ïù¥Ï†Ñ
                        </a>
                    </span>

                    <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏ ÎßÅÌÅ¨ -->
                    <span th:if="${userPage != null}" th:each="pageNumber : ${pageBars}">
                        <a class="page-link"
                           th:classappend="${pageNumber == userPage.number} ? 'active'"
                           th:href="@{/admin/userList(page=${pageNumber}, size=${userPage.size}, searchCriteria=${searchCriteria}, keyword=${keyword}, membership=${membership}, season=${season}, status=${status})}"
                           th:text="${pageNumber + 1}">1</a>
                    </span>

                    <!-- Îã§Ïùå ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
                    <span th:if="${userPage != null}"
                          th:classappend="${userPage.number + 1 == userPage.totalPages} ? 'disabled'">
                        <a th:href="${userPage.number + 1 < userPage.totalPages} ? @{/admin/userList(page=${userPage.number + 1}, size=${userPage.size}, searchCriteria=${searchCriteria}, keyword=${keyword}, membership=${membership}, season=${season}, status=${status})} : '#'">
                            Îã§Ïùå
                        </a>
                    </span>
                </div>
            </div>
        </div>
    </section>
</div>
</body>
</html>