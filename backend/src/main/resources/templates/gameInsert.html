<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layoutReal}">
<head>
    <!-- ê°œë³„ í˜ì´ì§€ ì „ìš© CSS íŒŒì¼ -->
    <link rel="stylesheet" th:href="@{/css/game-insert.css}">
</head>
<meta charset="UTF-8">
<body>
<div layout:fragment="content" class="content">
  <section>
    <div class="game-insert-page">
      <div class="menu-title">ì‹ ê·œ ê²½ê¸° ì…ë ¥</div>

      <!-- ì‹ ê·œ ê²½ê¸° í¼ -->
      <!--   th:action="@{/admin/game/insert}" ì‚­ì œ   -->
      <form id="gameInsertForm" class="form-table">

        <!-- ê²½ê¸° ë‚ ì§œ ë° ì‹œê°„ -->
        <div class="form-row">
          <label for="matchDate">ğŸ ê²½ê¸° ë‚ ì§œ</label>
          <input type="date" id="matchDate" name="matchDate" th:value="${matchDatePart}" required />
          <input type="time" id="matchTime" name="matchTime" th:value="${matchTimePart}" required />
        </div>

        <!-- ê²½ê¸°ì¥ ì„ íƒ -->
        <div class="form-row">
          <label for="matchStadium">ğŸ ê²½ê¸°ì¥</label>
          <select id="matchStadium" required>
            <option value="HOME">HOME</option>
            <option value="AWAY">AWAY</option>
          </select>
        </div>

        <!-- ì ìˆ˜ ì…ë ¥ -->
        <div class="form-row">
          <label for="matchSetScore">ğŸ ìš°ë¦¬ íŒ€ ì„¸íŠ¸ ìˆ˜</label>
          <input type="number" id="matchSetScore" required min="0" max="5" value="0"/>
        </div>
        <div class="form-row">
          <label for="matchOpponentTeamSetScore">ğŸ ìƒëŒ€ íŒ€ ì„¸íŠ¸ ìˆ˜</label>
          <input type="number" id="matchOpponentTeamSetScore" required min="0" max="5" value="0"/>
        </div>

        <!-- ì‹œì¦Œ ì„ íƒ -->
        <div class="form-row">
          <label for="seasonId">ğŸ ì‹œì¦Œ</label>
          <select id="seasonId" required>
            <option th:each="season : ${seasons}" th:value="${season.seasonId}" th:text="${season.seasonName}">
            </option>
          </select>
        </div>

        <!-- ë¼ìš´ë“œ ì„ íƒ -->
        <div class="form-row">
          <label for="matchRoundId">ğŸ ë¼ìš´ë“œ</label>
          <select id="matchRoundId" required>
            <option th:each="round : ${rounds}" th:value="${round}" th:text="${round + 'ë¼ìš´ë“œ'}"></option>
          </select>
        </div>

        <!-- íŒ€ ì´ë¦„ ì„ íƒ -->
        <div class="form-row">
          <label for="teamId">ğŸ íŒ€ ì´ë¦„</label>
          <select id="teamId" required>
            <option th:each="team : ${teams}" th:value="${team.teamId}" th:text="${team.teamName}"></option>
          </select>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="button-group">
          <button type="submit" class="btn-submit">ì €ì¥</button>
          <button type="button" onclick="window.location.href='/admin/game'" class="btn-back">ëŒì•„ê°€ê¸°</button>
        </div>
      </form>
    </div>
  </section>

  <script th:inline="javascript">
    $(document).ready(function() {
      // í¼ ì œì¶œ ì‹œ ë°ì´í„° ì²˜ë¦¬
      $('#gameInsertForm').on('submit', function(event) {
        event.preventDefault();

        // ë‚ ì§œì™€ ì‹œê°„ í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸°
        const matchDate = $('#matchDate').val();
        const matchTime = $('#matchTime').val();

        // í•„ìš”í•œ ë°ì´í„° êµ¬ì„±
        const matchData = {
          matchDate: `${matchDate}T${matchTime}`, // ë‚ ì§œì™€ ì‹œê°„ì„ ì¡°í•©í•˜ì—¬ ISO í˜•ì‹ìœ¼ë¡œ ì„¤ì •
          matchStadium: $('#matchStadium').val(),
          matchSetScore: $('#matchSetScore').val(),
          matchOpponentTeamSetScore: $('#matchOpponentTeamSetScore').val(),
          seasonId: $('#seasonId').val(),
          matchRoundId: $('#matchRoundId').val(),
          teamId: $('#teamId').val()
        };

        // Ajax ìš”ì²­
        $.ajax({
          url: '/admin/game/insert',
          type: 'POST',
          dataType: 'text',  // ì„œë²„ì—ì„œ String ì‘ë‹µì„ ë°›ê¸° ë•Œë¬¸ì— textë¡œ ì„¤ì •
          data: JSON.stringify(matchData),
          headers: {
            "Content-Type": "application/json"
          },
          success: function(response) {
            alert(response);  // ì„œë²„ì˜ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            window.location.href = '/admin/game';  // ì €ì¥ í›„ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
          },
          error: function(xhr, status, error) {
            console.error('ê²½ê¸° ë“±ë¡ ì˜¤ë¥˜:', error);
            alert('ê²½ê¸° ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        });
      });
    });
  </script>
</div>
</body>
</html>